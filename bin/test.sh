#!/bin/bash
set -euo pipefail

docker run --rm -v ./:/go/$(GOWORKING_DIR) golang:$(GO_VERSION) sh -c "cd $(GOWORKING_DIR); go test $(GO_FILES) -coverprofile=coverage.out; go tool cover -html=coverage.out -o coverage.html; go tool cover --func coverage.out"

# set ownership for file generated by docker
chown -R $(id -un):$(id -un) coverage.out
chown -R $(id -un):$(id -un) coverage.html
